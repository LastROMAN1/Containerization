
pipeline {
  agent any
  stages {

    // stage ('Change working dir') {
    //   steps {
    //      dir('tooling/') {
    //       sh 'pwd'
    //      }
    //   }
    
    // }


    stage ('Build and push') {
      steps {
        // Build the docker image using the Dockerfile in the project root
        script {
          docker.withRegistry('', '5c8d62c3-46cf-4989-97c0-0d1392a28899') {
            dir('tooling/'){
              sh 'pwd'
              def toolingImage = docker.build("${env.BRANCH_NAME}-tooling:${env.BUILD_ID}") 

              // Push the docker image to the docker hub repository
              toolingImage.push("warriconnected/${env.BRANCH_NAME}-tooling:${env.BUILD_ID}")
            }
            

          }
          
          
        }
      }
    }
    // stage ('Push') {
    //   steps {
    //     // Push the docker image to the docker hub repository
    //     script {
    //         docker.withRegistry('', '5c8d62c3-46cf-4989-97c0-0d1392a28899') {
    //         toolingImage.push("${env.BRANCH_NAME}-tooling:${env.BUILD_ID}")
    //       }
    //     }
    //   }
    // }

    stage('Cleanup after build') {
      steps {
        cleanWs(cleanWhenAborted: true, cleanWhenFailure: true, cleanWhenNotBuilt: true, cleanWhenUnstable: true, deleteDirs: true)
      }
    }
  }
}
